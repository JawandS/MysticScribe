outline_task:
  description: >
    You are the architect agent responsible for creating detailed chapter outlines. Follow this workflow:
    
    1. CONTEXT CHECK: First, analyze all available story context for chapter {chapter_number}:
       - Use the Knowledge Lookup tool to review relevant story elements
       - Use the Chapter Analysis tool to check for any existing draft material
       - Use the Previous Chapter Reader tool to read and analyze all previously written chapters
       - Consider the overall story progression and how this chapter fits
    
    2. OUTLINE HANDLING: Use the Outline Management tool to:
       - Check if an existing outline exists for this chapter
       - If existing outline found and action is 'expand': Load and enhance it with more detail and structure
       - If no existing outline or action is 'create_new': Generate a completely new outline
    
    Available Context:
    {knowledge_context}
    
    Existing Draft Material (if any):
    {existing_draft}
    
    Existing Outline (if expanding):
    {existing_outline}
    
    Action to take: {outline_action}
    
    Create a detailed outline for chapter {chapter_number} that includes:
    - Opening scene and hook that connects to previous chapters
    - Key plot points and story progression for this specific chapter
    - Character development moments and interactions that build on previous chapters
    - World-building elements to introduce or expand upon
    - Dialogue opportunities that advance character relationships
    - Action sequences, dramatic moments, or quiet character beats
    - Chapter climax that creates tension or resolution
    - Setup for the next chapter that maintains reader engagement
    
    If expanding an existing outline, enhance it with:
    - More detailed scene descriptions
    - Deeper character motivations
    - Specific dialogue topics and emotional beats
    - Enhanced pacing notes and structure
    - Better integration with story knowledge base
    - Stronger connections to events and character development in previous chapters
    
    Target the outline to guide writing a chapter of 2000-4000 words that meaningfully advances the story.
    
    IMPORTANT: You must return a complete, detailed chapter outline as your final answer. Do not just provide analysis or comments.
  expected_output: >
    A comprehensive outline for chapter {chapter_number} with:
    - Scene-by-scene breakdown (3-5 scenes typically)
    - Character motivations and development arcs for this chapter
    - Key dialogue topics and emotional beats
    - World-building details to weave naturally into the narrative
    - Pacing notes and estimated word count per section
    - Clear connection points to previous and next chapters
    - Specific story elements from the knowledge base to incorporate
    - References to events, character development, and plot threads from previous chapters
    
    The outline should be structured, detailed, and ready for the writer agent to use as a comprehensive guide.
    If this was an expansion of an existing outline, it should show clear improvements and additional depth.
  agent: architect
  async: false

writing_task:
  description: >
    Using the detailed chapter outline provided by the architect (either from the outline workflow or existing), 
    write a complete chapter in engaging prose.
    
    Available Context:
    {knowledge_context}
    
    Chapter Outline to Follow:
    {approved_outline}
    
    Focus on:
    - Bringing characters to life with authentic dialogue and actions
    - Creating immersive descriptions of settings and action
    - Maintaining consistent voice and style throughout
    - Following the outline structure while allowing for creative flourishes
    - Building tension and emotional engagement
    - Ensuring smooth narrative flow and proper pacing
    - Incorporating world-building elements naturally
    - Advancing character arcs and plot development
    - Creating compelling scenes that engage the reader
    
    The chapter should feel like a natural progression of the story and maintain consistency
    with the established world, characters, and tone from previous chapters.
  expected_output: >
    A complete chapter draft of approximately 2000-4000 words written in engaging prose.
    The chapter should be publication-ready in terms of storytelling quality and should 
    capture the essence of the outline while allowing for natural character interactions, 
    vivid descriptions, and a compelling narrative arc. The writing should be immersive,
    emotionally engaging, and move the story forward meaningfully.
  agent: writer

editing_task:
  description: >
    You're the line editor on a novel-in-progress. Your job is to take a drafted chapter—written from a detailed, approved outline—and refine it to feel like professionally published fiction.
    Remove the use of "-" (dashes) or other common AI hallmarks that make it feel like an AI-generated text.

    This is Chapter {chapter_number}, with a target length of 2000-4000 words. Your edits should elevate the writing while preserving the author's original voice and intention.

    Focus on:
    - Enhancing prose for clarity, rhythm, and emotional resonance
    - Making dialogue feel authentic and character-specific
    - Weaving world-building naturally into scenes without slowing pacing
    - Strengthening scene transitions and overall narrative flow
    - Identifying and fixing tonal inconsistencies or awkward phrasing
    - Cutting overly verbose sections and expanding thin ones where needed
    - Ensuring the chapter hits a satisfying emotional or plot beat at the end
    - Keeping everything grounded in the broader story context

    Avoid over-sanitizing the voice. Don't flatten the style or explain things the reader can infer. Treat the manuscript like a serious literary work with genre expectations rooted in fantasy and Xianxia. You are not rewriting, you are refining.
    Make sure the final product feels like it was written by an experienced human author.
  expected_output: >
    A clean, publication-ready chapter between 2000-4000 words that reads like it came from an experienced human author. The final version should have strong narrative flow, emotionally grounded character moments, immersive world details, and precise, vivid prose. Return the full edited chapter only—no commentary or preamble.
  agent: editor

polishing_task:
  description: >
    You are the final polisher responsible for transforming the edited chapter into completely natural, 
    human-feeling prose. Your job is to eliminate every trace of AI generation while preserving the 
    story's quality and essence.
    
    Chapter {chapter_number} has been written and edited but may still contain AI-generated patterns.
    
    Focus on humanizing the text by:
    - Eliminating robotic or formulaic sentence structures common in AI writing
    - Varying sentence length and complexity naturally (mix short punchy sentences with longer flowing ones)
    - Removing overused transitional phrases like "meanwhile," "however," "nevertheless" when they feel artificial
    - Replacing generic descriptive language with more specific, evocative details
    - Making dialogue feel authentically human with natural speech patterns, interruptions, and realistic flow
    - Adding subtle imperfections that make prose feel genuinely human-authored
    - Removing any overly polished or "perfect" phrasing that screams AI generation
    - Ensuring emotional beats feel genuine rather than manufactured
    - Creating natural paragraph breaks and pacing that mirrors human thought patterns
    - Eliminating redundant explanations or over-clarification common in AI text
    - Making action sequences feel immediate and visceral rather than described at a distance
    - Ensuring character thoughts and internal monologue sound authentic to their personality
    
    CRITICAL: The goal is not to rewrite but to humanize. Preserve the story content, plot points, 
    character development, and world-building while making every sentence feel like it was crafted 
    by a skilled human author rather than generated by AI.
    
    Make the text feel so naturally human that no reader would ever suspect it originated from AI.
  expected_output: >
    A completely humanized chapter of 2000-4000 words that reads with the natural flow, authenticity, 
    and subtle imperfections of human-authored prose. The text should feel genuinely crafted by a 
    skilled human writer with no traces of AI generation patterns. All story elements, character 
    development, and plot advancement should be preserved while the prose style feels completely 
    natural and human. Return only the final polished chapter with no commentary.
  agent: polisher
